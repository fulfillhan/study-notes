# 스프링 빈의 라이프사이클
**객체 생성가 생성된 후 의존관계 주입**

스프링 컨테이너가 스프링 빈으로 관리할 객체를 생성하고, 의존 관계를 모두 주입한 뒤에야 빈이 필요한 데이터를 사용할 수 있는 준비가 완료된다.
따라서 초기화 작업은 의존관계 주입이 모두 완료되고 난 다음에 호출되어야 한다.

**스프링은 의존관계 주입이 완료되면 스프링 빈에게 콜백 메서드를 통해서 초기화 시점을 알려주는 다양한 기능을 제공한다.뿐만 아니라 스프링 컨테이너가
종료되기 직전에 소멸 콜백을 하는데, 개발자는 특정 어노테이션을 사용해 이러한 작업들이 어떻게 진행되는지 호출해서 알 수 있다.**

## ⭐스프링 빈의 라이프사이클⭐
**스프링 컨테이너 생성-> 스프링 빈 생성 -> 의존관계 주입-> 초기화 콜백->사용-> 소멸전 콜백-> 스프링 종료**

- 초기화 콜백 : 빈이 생성되고 의존관계 주입이 완료된 후 호출
- 소멸 콜백: 빈이 소멸되기 직전에 호출

## 초기화
빈을 사용하기 위해 필요한 추가적입 설정이나 준비 작업을 수행하는 과정을 의미한다.

### 초기화 작업의 주요 목적
- 빈의 어플리케이션 실행에 앞서 필요한 리소스를 준비하거나 특정 상태를 설정한다.
- 예시 - 리소스 할당, 데이터 로딩, 검증 로직등등

```
참고: 객체의 생성과 초기화를 분리하자
(생성자 주입방식의 경우 객체 생성과 의존관계 주입 과정이 한 번에 처리된다)
생성자는 필수 정보를 받고, 메모리를 할당에서 객체를 생성하는 책임을 갖고 초기화는 이렇게 생성된 객체를 활용해서 외부 설정이나, 커넥션 연결하는등
무거운 작업을 수행한다. 따라서 생성자 안에서 무거운 초기화 작업을 같이 하는 것보다 객체를 생성하는 부분과 초기화 하는 부분을 분리하여 작업하는것이
유지보수에 낫다.(단순한 초기화 작업이라면 생성자를 통해 한번에 다 처리하는게 나을 수 있다.)
```
### 스프링은 크게 3가지 방법으로 빈 생명주기 콜백을 지원한다.
- 인터페이스
- 설정 정보에 초기화 메서드, 종료 메서드 지정
- @PostConstruct,@PreDestroy 지원

# @PostConstruct,@PreDestroy 사용
```
    @PostConstruct
 public void init() {
 System.out.println("NetworkClient.init");
 connect();
 call("초기화 연결 메시지");
 }
 
    @PreDestroy
 public void close() {
 System.out.println("NetworkClient.close");
 disConnect();
    }
```
**장점**

- 최신 스프링에서 지원하는 방식
- 매우 편리
- 패키지를 보면 `javax.annotation.PostConstruct`이다. 스프링에 종속적인 기술이 아니라 `JSR-250라는 자바 표준 스펙`이다.
  따라서 스프링이 아닌 다른 컨테이너에서도 동작한다.

**단점**
- **@PostConstruct은 스프링 컨테이너가 객체를 관리하면서 초기화 과정을 진행할 때 호출되기에 스프링 컨테이너에 의해 관리되는 빈에만 적용된다.**
  외부 라이브러리에는 적용하지 못한다. 따라서 스프링 컨테이너의 관리 대상이 아닌 객체에서는 초기화 작업이 적용되지 않는다.
  외부 객체는 `@bean(initMethod = "..."/ destroyMethod = "...")`을 통해 스프링 빈으로 등록하고 사용해야 한다.


- 트래잭션이 활성화 되지 않을 수 있다. 두 어노테이션은 동작 방식과 라이프사이클 관리에 차이가 있어서, 문제가 발생한다.

    - ``이유``: **스프링의 트랜잭션 관리가 빈 초기화 이후에 적용되기 때문이다.** 스프링은 AOP를 적용해 트랜잭션을 프록시를 통해 사용하는데, 프록시는 빈이 완전히
      초기화 된 이후 적용된다. 따라서 @PostConstruct는 실행하는 시점에는 트랜잭션이 적용되지 않는것이다.
  